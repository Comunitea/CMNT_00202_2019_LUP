<?xml version="1.0"?>
<odoo>

    <!-- MAIN MENU -->
    <menuitem id="menu_costs_root" name="Hojas de coste" sequence="30"/>

    <record id="cost_sheet_view_form" model="ir.ui.view">
        <field name="name">cost.sheet.view</field>
        <field name="model">cost.sheet</field>
        <field name="arch" type="xml">
            <form create="false">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>
                    <group>
                        <group string="General">
                            <field name="sheet_type"/>
                            <field name="increment"/>
                            <field name="inspection_type"/>
                            <!-- <field name="customer_note" class="oe_inline" placeholder="Customer Note"/> -->
                            <field name="description"/>
                        </group>
                        <group string="Modelos asociados">
                            <!-- <field name="group_id" class="oe_inline" placeholder="Customer Note"/> -->
                            <field name="sale_line_id"/>
                            <field name="sale_id"/>
                        </group>
                    </group>
                    <group string="Precios">
                        <group>
                                <field name="cost_init" attrs="{'invisible': [('sheet_type', 'in', ['fdm', 'dmls'])]}"/>
                                <field name="cost_init_computed"  attrs="{'invisible': [('sheet_type', 'not in', ['dmls'])]}"/>
                                <field name="cost_ud"/>
                                <field name="admin_fact"/>
                                <field name="use_disc_qty"  attrs="{'invisible': [('sheet_type', 'not in', ['fdm', 'sls', 'poly', 'sla', 'dmls'])]}"/> 

                        </group>
                        <group>
                                <!-- <field name="disc_qty" attrs="{'invisible': [('sheet_type', 'not in', ['design'])]}"/>  -->
                                <field name="disc_qty_computed" attrs="{'invisible': [('sheet_type', 'not in', ['fdm', 'sls', 'poly', 'sla', 'dmls'])]}"/>
                                <field name="disc2" attrs="{'invisible': [('sheet_type', 'not in', ['design'])]}"/>
                                <field name="increment" attrs="{'invisible': [('sheet_type', 'in', ['design'])]}"/>
                                <field name="price_unit"  attrs="{'invisible': [('sheet_type', 'in', ['design', 'unnplaned'])]}"/>
                                <field name="price_total"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Diseño" attrs="{'invisible': [('sheet_type', '!=', 'design')]}">
                            <group>
                                <group string="Datos pieza">
                                    <field name="flat_ref"/>
                                </group>
                                <group string="Carcterísticas pieza">
                                    <field name="feature_ids" nolabel="1" widget="many2many_checkboxes"/>
                                </group>
                                <group string="Legislación aplicable">
                                    <field name="legislation_ids" nolabel="1" widget="many2many_checkboxes"/>
                                </group>
                            </group>
                            <group string="Tiempos">
                                <field name="time_line_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="software_id"/>
                                        <field name="hours"/>
                                        <field name="price_hour"/>
                                        <field name="discount"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                <field name="hours_total" widget='time'/>
                                <field name="amount_total" widget='monetary'/>
                            </group>
                        </page>

                        <page string="FDM" attrs="{'invisible': [('sheet_type', '!=', 'fdm')]}">
               
                                <group cospan="4" col="8" string="Datos pieza">
                                    <field name="cus_units"/>
                                    <field name="cc_ud"/>
                                    <field name="euros_cc"/>
                                </group>
                                <group string="Carcterísticas pieza">
                                    <field name="feature_ids" nolabel="1" widget="many2many_checkboxes"/>
                                </group>
                                <group cospan="2" col="8" string="Parámetros impresión">
                                    <!-- <field name="printer_id" domain="[('type', '=', 'fdm')]"/> -->
                                    <field name="printer_id"/>
                                    <field name="perfil"/>
                                    <field name="tray_units"/>
                                    <field name="tray_hours"/>
                                    <field name="loops"/>
                                    <field name="infill"/>
                                    <field name="layer_height"/>
                                    <field name="euro_machine"/>
                                </group>
                 
                             <group colspan="4" string="Material Cost">
                                 <field name="material_cost_ids" nolabel="1"/>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="material_total">
                                    <field name="total_euro_ud" widget='monetary'/>
                                    <field name="total_material_cost" widget='monetary'/>
                            </group>
                            <div style="border-bottom: 1px solid black;"></div>
                            <group colspan="2" col="6" string="Coste Máquina">
                                <field name="machine_hours"/>
                                <field name="euro_machine_ud"/>
                                <field name="euro_machine_total"/>
                            </group>
                            <group colspan="4" string="Coste mano de obra">
                                <field name="workforce_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="hours"/>
                                        <field name="minutes"/>
                                        <field name="euro_unit"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                             <group class="oe_subtotal_footer oe_right" colspan="2" name="wf_total">
                                    <field name="workforce_total_euro_ud" widget='monetary'/>
                                    <field name="workforce_total" widget='monetary'/>
                            </group>
                             <group colspan="4" string="Coste externalizacion por pieza">
                                <field name="outsorcing_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cost"/>
                                        <field name="margin"/>
                                        <field name="pvp"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                    <field name="outsorcing_total_ud" widget='monetary'/>
                                    <field name="outsorcing_total" widget='monetary'/>
                            </group>
                            
                        </page>

                        <!-- SLS -->
                        <page string="SLS" attrs="{'invisible': [('sheet_type', '!=', 'sls')]}">
                            <group colspan="2" col="8" string="Datos pieza">
                                <field name="cus_units"/>
                                <field name="x_mm_sls"/>
                                <field name="y_mm_sls"/>
                                <field name="z_mm_sls"/>
                                <field name="cc_ud"/>
                                <field name="tinted_id"/>
                                <field name="cm2_sls"/>
                                <field name="e_cc_sls"/>
                            </group>
                            <group colspan="2" col="8" string="Parámetros impresión">
                                <field name="printer_id"/>
                                <field name="tray_units"/>
                                <field name="print_increment" attrs="{'invisible': [('sheet_type', 'in', ['poly'])]}"/>
                                <field name="tray_hours_sls"/>
                                <field name="euro_machine"/>
                            </group>
                             <group colspan="2" col="8" string="Configuración oferta">
                                <field name="offer_type"/>
                                <field name="solid_per_sls"/>
                                <field name="bucket_height_sls"/>
                                <field name="simulation_time_sls"/>
                            </group>
                             <group colspan="4" string="Material Cost">
                                 <field name="material_cost_ids" nolabel="1"/>
                            </group>
                             <group class="oe_subtotal_footer oe_right" colspan="2" name="material_total">
                                    <field name="total_euro_ud" widget='monetary'/>
                                    <field name="total_material_cost" widget='monetary'/>
                            </group>
                             <group colspan="2" col="6" string="Coste Máquina">
                                <field name="machine_hours"/>
                                <field name="euro_machine_ud"/>
                                <field name="euro_machine_total"/>
                            </group>
                            <group colspan="4" string="Coste mano de obra">
                                <field name="workforce_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="hours"/>
                                        <field name="minutes"/>
                                        <field name="euro_unit"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                             <group class="oe_subtotal_footer oe_right" colspan="2" name="wf_total">
                                    <field name="workforce_total_euro_ud" widget='monetary'/>
                                    <field name="workforce_total" widget='monetary'/>
                            </group>
                            <group colspan="4" string="Coste externalizacion por pieza">
                                <field name="outsorcing_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cost"/>
                                        <field name="margin"/>
                                        <field name="pvp"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                    <field name="outsorcing_total_ud" widget='monetary'/>
                                    <field name="outsorcing_total" widget='monetary'/>
                            </group>
                        </page>
                    

                        <!-- POLY -->
                         <page string="POLY" attrs="{'invisible': [('sheet_type', '!=', 'poly')]}">
                            <group colspan="2" col="8" string="Datos pieza">
                                <field name="cus_units"/>
                                <field name="cc_ud"/>
                                <field name="euros_cc"/>
                            </group>
                            <group colspan="2" col="8" string="Parámetros impresión">
                                <field name="printer_id"/>
                                <field name="tray_units"/>
                                <field name="finish_pol"/>
                                <field name="tray_hours"/>
                                <field name="euro_machine"/>
                            </group>
                            <group colspan="4" string="Material Cost">
                                 <field name="material_cost_ids" nolabel="1"/>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="material_total">
                                    <field name="total_euro_ud" widget='monetary'/>
                                    <field name="total_material_cost" widget='monetary'/>
                            </group>
                             <group colspan="2" col="6" string="Coste Máquina">
                                <field name="machine_hours"/>
                                <field name="euro_machine_ud"/>
                                <field name="euro_machine_total"/>
                            </group>
                            <group colspan="4" string="Coste mano de obra">
                                <field name="workforce_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="hours"/>
                                        <field name="minutes"/>
                                        <field name="euro_unit"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                             <group class="oe_subtotal_footer oe_right" colspan="2" name="wf_total">
                                    <field name="workforce_total_euro_ud" widget='monetary'/>
                                    <field name="workforce_total" widget='monetary'/>
                            </group>
                            <group colspan="4" string="Coste externalizacion por pieza">
                                <field name="outsorcing_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cost"/>
                                        <field name="margin"/>
                                        <field name="pvp"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                    <field name="outsorcing_total_ud" widget='monetary'/>
                                    <field name="outsorcing_total" widget='monetary'/>
                            </group>
                        </page>

                         <!-- SLA -->
                         <page string="SLA" attrs="{'invisible': [('sheet_type', '!=', 'sla')]}">
                            <group colspan="2" col="8" string="Datos pieza">
                                <field name="cus_units"/>
                                <field name="cc_ud"/>
                                <field name="euros_cc"/>
                            </group>
                            <group colspan="2" col="8" string="Parámetros impresión">
                                <field name="printer_id"/>
                                <field name="tray_units"/>
                                <field name="tray_hours"/>
                                <field name="euro_machine"/>
                            </group>
                             <group colspan="4" string="Material Cost">
                                 <field name="material_cost_ids" nolabel="1"/>
                            </group>
                             <group class="oe_subtotal_footer oe_right" colspan="2" name="material_total">
                                    <field name="total_euro_ud" widget='monetary'/>
                                    <field name="total_material_cost" widget='monetary'/>
                            </group>
                             <group colspan="2" col="6" string="Coste Máquina">
                                <field name="machine_hours"/>
                                <field name="euro_machine_ud"/>
                                <field name="euro_machine_total"/>
                            </group>
                            <group colspan="4" string="Coste mano de obra">
                                <field name="workforce_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="hours"/>
                                        <field name="minutes"/>
                                        <field name="euro_unit"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                             <group class="oe_subtotal_footer oe_right" colspan="2" name="wf_total">
                                    <field name="workforce_total_euro_ud" widget='monetary'/>
                                    <field name="workforce_total" widget='monetary'/>
                            </group>
                            <group colspan="4" string="Coste externalizacion por pieza">
                                <field name="outsorcing_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cost"/>
                                        <field name="margin"/>
                                        <field name="pvp"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                    <field name="outsorcing_total_ud" widget='monetary'/>
                                    <field name="outsorcing_total" widget='monetary'/>
                            </group>
                        </page>

                         <!-- DMLS -->
                        <page string="DMLS" attrs="{'invisible': [('sheet_type', '!=', 'dmls')]}">
                            <group colspan="2" col="8" string="Datos pieza">
                                <field name="cus_units"/>
                                <field name="cc_ud"/>
                                <field name="cc_soport_dmls"/>
                                <field name="euros_cc"/>
                            </group>
                            <group colspan="2" col="8" string="Parámetros impresión">
                                <field name="printer_id"/>
                                <field name="tray_units"/>
                                <field name="tray_hours"/>
                                <field name="euro_machine"/>
                            </group>
                            <group colspan="4" string="Material Cost">
                                 <field name="material_cost_ids" nolabel="1"/>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="material_total">
                                    <field name="total_euro_ud" widget='monetary'/>
                                    <field name="total_material_cost" widget='monetary'/>
                            </group>
                            <group colspan="2" col="6" string="Coste Máquina">
                                <field name="machine_hours"/>
                                <field name="euro_machine_ud"/>
                                <field name="euro_machine_total"/>
                            </group>
                            <group colspan="4" string="Coste mano de obra">
                                <field name="workforce_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="hours"/>
                                        <field name="minutes"/>
                                        <field name="euro_unit"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="wf_total">
                                    <field name="workforce_total_euro_ud" widget='monetary'/>
                                    <field name="workforce_total" widget='monetary'/>
                            </group>
                            <group colspan="4" string="Coste externalizacion por pieza">
                                <field name="outsorcing_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cost"/>
                                        <field name="margin"/>
                                        <field name="pvp"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                    <field name="outsorcing_total_ud" widget='monetary'/>
                                    <field name="outsorcing_total" widget='monetary'/>
                            </group>
                        </page>

                        <page string="Imprevistos" attrs="{'invisible': [('sheet_type', '!=', 'unplanned')]}">
                            <group>
                                <field name="unplanned_cost"/>
                            </group>
                        </page>


                    </notebook>
                   
                   
                </sheet>
            </form>
        </field>
    </record>

    <record id="cost_sheet_view_tree" model="ir.ui.view">
        <field name="name">cost.sheet.view</field>
        <field name="model">cost.sheet</field>
        <field name="arch" type="xml">
            <!-- <tree create="false"> -->
            <tree>
                <field name="name"/>
                <field name="sheet_type"/>
                <field name="sale_line_id"/>
                <field name="sale_id"/>
                <field name="task_id"/>
                <field name="production_id"/>
                <field name="price_total"/>
            </tree>
        </field>
    </record>

    <record id="cost_sheet_view_search" model="ir.ui.view">
        <field name="name">cost.sheet.view.search</field>
        <field name="model">cost.sheet</field>
        <field name="arch" type="xml">
            <search>
                <field name="sale_line_id"/>
                <field name="sale_id"/>
                <field name="group_id"/>
                
                <group expand="0" string="Group By">
                    <filter name="group_line"  string="Sale Line"  domain="[]" context="{'group_by':'sale_line_id'}"/>
                    <filter name="group_sale" string="Sale Order" domain="[]" context="{'group_by':'sale_id'}"/>
                    <filter name="group_group" string="Cost Group" domain="[]" context="{'group_by':'group_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_cost_sheets" model="ir.actions.act_window">
        <field name="name">Hojas de coste</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">cost.sheet</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_cost_sheets" name="Costes" parent="menu_costs_root" sequence="10"/>

    <menuitem id="menu_action_cost_sheets" action="action_cost_sheets"  name="Hojas de coste" parent="menu_cost_sheets" sequence="20"/>


    <record id="product_cost_sheet_view_tree" model="ir.ui.view">
        <field name="name">group.cost.sheet.view</field>
        <field name="model">group.cost.sheet</field>
        <field name="arch" type="xml">
            <tree create="false">
                <field name="sale_line_id"/>
                <field name="sale_id"/>
                <field name="admin_fact"/>
            </tree>
        </field>
    </record>

    <record id="product_cost_sheet_view_form" model="ir.ui.view">
        <field name="name">group.cost.sheet.view</field>
        <field name="model">group.cost.sheet</field>
        <field name="arch" type="xml">
            <form create="false">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="sale_line_id"/>
                        </h1>
                        <h2>
                            <field name="product_id"/>
                        </h2>
                        <h3>
                            <field name="sale_id"/>
                        </h3>
                    </div>
                    <group>
                        <field name="admin_fact"/>
                        <field name="ing_hours"/>
                        <field name="tech_hours"/>
                        <field name="help_hours"/>
                    </group>

                    <group colespan="4" string="Hojas de coste">
                        <field name="sheet_ids" nolabel="1"/>
                    </group>
                    <group class="oe_subtotal_footer oe_right" colspan="2" name="pvp_total">
                        <field name="line_pvp" widget='monetary'/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="product_cost_sheet_view_search" model="ir.ui.view">
        <field name="name">group.cost.sheet.view.search</field>
        <field name="model">group.cost.sheet</field>
        <field name="arch" type="xml">
            <search>
                <field name="sale_line_id"/>
                <field name="product_id"/>
                <field name="product_id"/>
                
                <group expand="0" string="Group By">
                    <filter string="Sale Line" name="group_line" domain="[]" context="{'group_by':'sale_line_id'}"/>
                    <filter name="group_prouct" string="Pedido de venta" domain="[]" context="{'group_by':'sale_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_product_cost_sheets" model="ir.actions.act_window">
        <field name="name">Hojas de coste</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">group.cost.sheet</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_product_cost_sheets" action="action_product_cost_sheets"  name="Grupos de costes" parent="menu_cost_sheets" sequence="0"/>

    <!-- Vistas de campos One2many -->
    <record id="cost_material_line_view_tree" model="ir.ui.view">
        <field name="name">cost_materual_line_view_tree</field>
        <field name="model">material.cost.line</field>
        <field name="arch" type="xml">
            <tree editable="bottom">
                <field name="name"/>
                <field name="material_id"/>
                <!-- <field name="material_id"  domain="[('type', '=', 'fdm')]" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'fdm')]}"/>
                <field name="material_id"  domain="[('type', '=', 'sls')]" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'sls')]}"/>
                <field name="material_id"  domain="[('type', '=', 'poly')]" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'poly')]}"/> -->
                <!-- FDM FIELDS -->
                <field name="diameter" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'fdm')]}"/>
                <field name="color" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'fdm')]}"/>
                <field name="tray_meters" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'fdm')]}"/>
                <field name="gr_cc_tray" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'fdm')]}"/>
                <field name="gr_cc_total" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'fdm')]}"/>

                <!-- SLS fields -->
                <field name="sls_gr_tray" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'sls')]}"/>
                <field name="sls_gr_total" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'sls')]}"/>

                <!--Poly fields -->
                <field name="pol_gr_tray" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'poly')]}"/>
                <!--SLA fields -->
                <field name="sla_cc_tray" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'sla')]}"/>
                <!--DMLS fields -->
                <field name="dmls_cc_tray" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'dmls')]}"/>
                
                <field name="desviation" attrs="{'column_invisible': [('parent.sheet_type', 'not in', ['poly', 'sla', 'dmls'])]}"/>
                <!--Poly fields -->
                <field name="pol_gr_total" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'poly')]}"/>
                <!--SLA fields -->
                <field name="sla_cc_total" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'sla')]}"/>
                <!--DMLS fields -->
                <field name="dmls_cc_total" attrs="{'column_invisible': [('parent.sheet_type', '!=', 'dmls')]}"/>

                <field name="euro_material"/>
                <field name="total" attrs="{'column_invisible': [('parent.sheet_type', '=', 'fdm')]}"/>
            </tree>
        </field>
    </record>

</odoo>