<?xml version="1.0"?>
<odoo>

    <!-- MAIN MENU -->
    <menuitem id="menu_costs_root" name="Hojas de coste" sequence="30"/>

    <record id="cost_sheet_view_form" model="ir.ui.view">
        <field name="name">cost.sheet.view</field>
        <field name="model">cost.sheet</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>
                    <group>
                        <group string="General">
                            <field name="sheet_type"/>
                            <field name="increment"/>
                            <field name="inspection_type"/>
                            <field name="customer_note" class="oe_inline" placeholder="Customer Note"/>
                        </group>
                        <group string="Modelos asociados">
                            <field name="group_id" class="oe_inline" placeholder="Customer Note"/>
                            <field name="sale_line_id"/>
                            <field name="sale_id"/>
                        </group>
                    </group>
                    <group string="Precios" col="6">
                            <field name="init_cost"/>
                            <field name="admin_fact"/>
                            <field name="disc_qty" attrs="{'invisible': [('sheet_type', '==', 'fdm')]}"/>
                            <field name="disc_qty_computed" attrs="{'invisible': [('sheet_type', '!=', 'fdm')]}"/>
                            <field name="disc2"/>
                            <field name="price_unit"  attrs="{'invisible': [('sheet_type', '==', 'design')]}"/>
                            <field name="price_total"/>
                    </group>
                    <notebook>
                        <page string="Diseño" attrs="{'invisible': [('sheet_type', '!=', 'design')]}">
                            <group>
                                <group string="Datos pieza">
                                    <field name="flat_ref"/>
                                    <field name="description"/>
                                </group>
                                <group string="Legislación aplicable">
                                    <field name="legislation_ids" nolabel="1" widget="many2many_checkboxes"/>
                                </group>
                            </group>
                            <group string="Tiempos">
                                <field name="time_line_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="software_id"/>
                                        <field name="hours"/>
                                        <field name="price_hour"/>
                                        <field name="discount"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                <field name="hours_total" widget='time'/>
                                <field name="amount_total" widget='monetary'/>
                            </group>
                        </page>

                        <page string="FDM" attrs="{'invisible': [('sheet_type', '!=', 'fdm')]}">
               
                                <group cospan="4" col="8" string="Datos pieza">
                                    <field name="cus_units"/>
                                    <field name="cc_ud_fdm"/>
                                    <field name="stat_data"/>
                                    <field name="euros_cc"/>
                                </group>
                                <group cospan="2" col="8" string="Parámetros impresión">
                                    <field name="printer_id"/>
                                    <field name="tray_units"/>
                                    <field name="infill"/>
                                    <field name="loops"/>
                                    <field name="layer_height"/>
                                    <field name="tray_hours"/>
                                    <field name="euro_machine"/>
                                    <field name="perfil"/>
                                </group>
                 
                            <group colspan="4" string="Material Cost">
                                <field name="material_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="diameter"/>
                                        <field name="material_id" domain="[('type', '=', 'fdm')]"/>
                                        <field name="color"/>
                                        <field name="tray_meters"/>
                                        <field name="gr_cc_tray"/>
                                        <field name="gr_cc_total"/>
                                        <field name="euro_material"/>
                                    </tree>
                                </field>
                                <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                    <field name="total_euro_ud" widget='monetary'/>
                                    <field name="total_material_cost" widget='monetary'/>
                                </group>
                            </group>
                            <group colspan="2" col="6" string="Coste Máquina">
                                <field name="machine_hours"/>
                                <field name="euro_machine_ud"/>
                                <field name="euro_machine_total"/>
                            </group>
                            <group colspan="4" string="Coste mano de obra">
                                <field name="workforce_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="hours"/>
                                        <field name="minutes"/>
                                        <field name="euro_unit"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                             <group class="oe_subtotal_footer oe_right" colspan="2" name="wf_total">
                                    <field name="workforce_total_euro_ud" widget='monetary'/>
                                    <field name="workforce_total" widget='monetary'/>
                            </group>
                             <group colspan="4" string="Coste externalizacion por pieza">
                                <field name="outsorcing_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cost"/>
                                        <field name="margin"/>
                                        <field name="pvp"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                    <field name="outsorcing_total_ud" widget='monetary'/>
                                    <field name="outsorcing_total" widget='monetary'/>
                            </group>
                            <group string="Carcterísticas pieza">
                                <field name="feature_ids" nolabel="1" widget="many2many_checkboxes"/>
                            </group>
                        </page>

                        <!-- SLS -->
                        <page string="SLS" attrs="{'invisible': [('sheet_type', '!=', 'sls')]}">
                            <group colspan="2" col="8" string="Datos pieza">
                                <field name="cus_units"/>
                                <field name="cc_und_sls"/>
                                <field name="cm2_sls"/>
                                <field name="static_data_sls"/>
                                <field name="x_mm_sls"/>
                                <field name="y_mm_sls"/>
                                <field name="z_mm_sls"/>
                                <field name="e_cc_sls"/>
                            </group>
                            <group colspan="2" col="8" string="Parámetros impresión">
                                <field name="sls_printer_id"/>
                                <field name="tray_units"/>
                                <field name="increment_sls"/>
                                <field name="tray_hours_sls"/>
                                <field name="euro_machine_sls"/>
                            </group>
                             <group colspan="2" col="8" string="Configuración oferta">
                                <field name="offer_type"/>
                                <field name="solid_per_sls"/>
                                <field name="bucket_height_sls"/>
                                <field name="simulation_time_sls"/>
                            </group>
                            <group colspan="4" string="Material Cost">
                                <field name="sls_material_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="material_id" domain="[('type', '=', 'sls')]"/>
                                        <field name="sls_gr_tray"/>
                                        <field name="sls_gr_total"/>
                                        <field name="sls_euro_material"/>
                                        <field name="sls_total"/>
                                    </tree>
                                </field>
                            </group>
                             <group colspan="2" col="6" string="Coste Máquina">
                                <field name="machine_hours_sls"/>
                                <field name="euro_machine_ud_sls"/>
                                <field name="euro_machine_total_sls"/>
                            </group>
                            <group colspan="4" string="Coste mano de obra">
                                <field name="sls_workforce_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="minutes"/>
                                        <field name="euro_unit"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                            <group colspan="4" string="Coste externalizacion por pieza">
                                <field name="outsorcing_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cost"/>
                                        <field name="margin"/>
                                        <field name="pvp"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                    <field name="outsorcing_total_ud" widget='monetary'/>
                                    <field name="outsorcing_total" widget='monetary'/>
                            </group>
                        </page>
                    

                        <!-- POLY -->
                         <page string="POLY" attrs="{'invisible': [('sheet_type', '!=', 'poly')]}">
                            <group colspan="2" col="8" string="Datos pieza">
                                <field name="units_pol"/>
                                <field name="cc_und_pol"/>
                                <field name="stat_data_pol"/>
                                <field name="euros_cc_pol"/>
                            </group>
                            <group colspan="2" col="8" string="Parámetros impresión">
                                <field name="pol_printer_id"/>
                                <field name="tray_units_pol"/>
                                <field name="finish_pol"/>
                                <field name="tray_hours_pol"/>
                                <field name="euro_machine_pol"/>
                            </group>
                            <group colspan="4" string="Material Cost">
                                <field name="pol_material_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="gr_tray"/>
                                        <field name="gr_total"/>
                                        <field name="euro_material"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                             <group colspan="2" col="6" string="Coste Máquina">
                                <field name="machine_hours_pol"/>
                                <field name="euro_machine_ud_pol"/>
                                <field name="euro_machine_total_pol"/>
                            </group>
                            <group colspan="4" string="Coste mano de obra">
                                <field name="pol_workforce_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="minutes"/>
                                        <field name="euro_unit"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                            <group colspan="4" string="Coste externalizacion por pieza">
                                <field name="outsorcing_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cost"/>
                                        <field name="margin"/>
                                        <field name="pvp"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                    <field name="outsorcing_total_ud" widget='monetary'/>
                                    <field name="outsorcing_total" widget='monetary'/>
                            </group>
                        </page>

                         <!-- SLA -->
                         <page string="SLA" attrs="{'invisible': [('sheet_type', '!=', 'sla')]}">
                            <group colspan="2" col="8" string="Datos pieza">
                                <field name="units_sla"/>
                                <field name="cc_und_sla"/>
                                <field name="stat_data_sla"/>
                                <field name="euros_cc_sla"/>
                            </group>
                            <group colspan="2" col="8" string="Parámetros impresión">
                                <field name="sla_printer_id"/>
                                <field name="tray_units_sla"/>
                                <field name="tray_hours_sla"/>
                                <field name="euro_machine_sla"/>
                            </group>
                            <group colspan="4" string="Material Cost">
                                <field name="sla_material_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="material_id"/>
                                        <field name="gr_tray"/>
                                        <field name="desviation"/>
                                        <field name="cc_total"/>
                                        <field name="euro_material"/>
                                    </tree>
                                </field>
                            </group>
                             <group colspan="2" col="6" string="Coste Máquina">
                                <field name="machine_hours_sla"/>
                                <field name="euro_machine_ud_sla"/>
                                <field name="euro_machine_total_sla"/>
                            </group>
                            <group colspan="4" string="Coste mano de obra">
                                <field name="sla_workforce_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="minutes"/>
                                        <field name="euro_unit"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                            <group colspan="4" string="Coste externalizacion por pieza">
                                <field name="outsorcing_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cost"/>
                                        <field name="margin"/>
                                        <field name="pvp"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                    <field name="outsorcing_total_ud" widget='monetary'/>
                                    <field name="outsorcing_total" widget='monetary'/>
                            </group>
                        </page>

                         <!-- DMLS -->
                            <page string="DMLS" attrs="{'invisible': [('sheet_type', '!=', 'dmls')]}">                            <group colspan="2" col="8" string="Datos pieza">
                                <field name="units_sla"/>
                                <field name="cc_und_sla"/>
                                <field name="cc_soport"/>
                                <field name="stat_data_dmls"/>
                                <field name="euros_cc_dmls"/>
                            </group>
                            <group colspan="2" col="8" string="Parámetros impresión">
                                <field name="dmls_printer_id"/>
                                <field name="tray_units_dmls"/>
                                <field name="tray_hours_dmls"/>
                                <field name="euro_machine_dmls"/>
                            </group>
                            <group colspan="4" string="Material Cost">
                                <field name="dmls_material_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="material_id"/>
                                        <field name="gr_tray"/>
                                        <field name="desviation"/>
                                        <field name="gr_total"/>
                                        <field name="euro_material"/>
                                    </tree>
                                </field>
                            </group>
                             <group colspan="2" col="6" string="Coste Máquina">
                                <field name="machine_hours_dmls"/>
                                <field name="euro_machine_ud_dmls"/>
                                <field name="euro_machine_total_dmls"/>
                            </group>
                            <group colspan="4" string="Coste mano de obra">
                                <field name="dmls_workforce_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="minutes"/>
                                        <field name="euro_unit"/>
                                        <field name="total"/>
                                    </tree>
                                </field>
                            </group>
                            <group colspan="4" string="Coste externalizacion por pieza">
                                <field name="outsorcing_cost_ids" nolabel="1">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="cost"/>
                                        <field name="margin"/>
                                        <field name="pvp"/>
                                    </tree>
                                </field>
                            </group>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="design_total">
                                    <field name="outsorcing_total_ud" widget='monetary'/>
                                    <field name="outsorcing_total" widget='monetary'/>
                            </group>
                        </page>


                    </notebook>
                   
                   
                </sheet>
            </form>
        </field>
    </record>

    <record id="cost_sheet_view_tree" model="ir.ui.view">
        <field name="name">cost.sheet.view</field>
        <field name="model">cost.sheet</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="sheet_type"/>
                <field name="sale_line_id"/>
                <field name="sale_id"/>
                <field name="task_id"/>
                <field name="production_id"/>
                <field name="price_total"/>
            </tree>
        </field>
    </record>

    <record id="cost_sheet_view_search" model="ir.ui.view">
        <field name="name">cost.sheet.view.search</field>
        <field name="model">cost.sheet</field>
        <field name="arch" type="xml">
            <search>
                <field name="sale_line_id"/>
                <field name="sale_id"/>
                <field name="group_id"/>
                
                <group expand="0" string="Group By">
                    <filter name="group_line"  string="Sale Line"  domain="[]" context="{'group_by':'sale_line_id'}"/>
                    <filter name="group_sale" string="Sale Order" domain="[]" context="{'group_by':'sale_id'}"/>
                    <filter name="group_group" string="Cost Group" domain="[]" context="{'group_by':'group_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_cost_sheets" model="ir.actions.act_window">
        <field name="name">Hojas de coste</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">cost.sheet</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_cost_sheets" name="Costes" parent="menu_costs_root" sequence="10"/>

    <menuitem id="menu_action_cost_sheets" action="action_cost_sheets"  name="Hojas de coste" parent="menu_cost_sheets" sequence="20"/>


    <record id="product_cost_sheet_view_tree" model="ir.ui.view">
        <field name="name">group.cost.sheet.view</field>
        <field name="model">group.cost.sheet</field>
        <field name="arch" type="xml">
            <tree>
                <field name="sale_line_id"/>
                <field name="admin_fact"/>
            </tree>
        </field>
    </record>

    <record id="product_cost_sheet_view_form" model="ir.ui.view">
        <field name="name">group.cost.sheet.view</field>
        <field name="model">group.cost.sheet</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="sale_line_id"/>
                        </h1>
                        <h2>
                            <field name="product_id"/>
                        </h2>
                    </div>
                    <group>
                        <field name="admin_fact"/>
                        <field name="ing_hours"/>
                        <field name="tech_hours"/>
                        <field name="help_hours"/>
                    </group>

                    <group colespan="4" string="Hojas de coste">
                        <field name="sheet_ids" nolabel="1"/>
                    </group>
                    <group class="oe_subtotal_footer oe_right" colspan="2" name="pvp_total">
                        <field name="line_pvp" widget='monetary'/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="product_cost_sheet_view_search" model="ir.ui.view">
        <field name="name">group.cost.sheet.view.search</field>
        <field name="model">group.cost.sheet</field>
        <field name="arch" type="xml">
            <search>
                <field name="sale_line_id"/>
                <field name="product_id"/>
                
                <group expand="0" string="Group By">
                    <filter string="Sale Line" name="group_line" domain="[]" context="{'group_by':'sale_line_id'}"/>
                    <filter name="group_prouct" string="group_product" domain="[]" context="{'group_by':'product_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_product_cost_sheets" model="ir.actions.act_window">
        <field name="name">Hojas de coste</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">group.cost.sheet</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_product_cost_sheets" action="action_product_cost_sheets"  name="Grupos de costes" parent="menu_cost_sheets" sequence="0"/>
</odoo>